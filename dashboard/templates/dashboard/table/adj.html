{% extends 'dashboard/elements/layouts/admin.html' %}
{% load humanize %}

{% load static %}

{% block additional_css %}

{% endblock %}

{% block content %}



        <!-- row -->


        <div class="row">


            <div class="col-12">

                <div class="card p-2">                      
                                        
                                   
                    <div class="card-body">
                        
                        <form method="post">
                            {% csrf_token %}

                            <div class="d-flex flex-row-reverse my-4">
                              <h3> Adjustment </h3>
                              </div>

                            <div id="typeform">
                            {{adjform.type}}
                            </div>

                            <div id="clientform" style="display:none;">
                                <p>Select the client...</p>                 

                                <input type="text" name="client" id="client" class="form-control" placeholder="Client" autocomplete="on" list="clients">
                                    <datalist id="clients">
                                    {% for client in clients %}
                                    <option id="{{client.id}}" value="{{ client.name }}">
                                    {% endfor %}
                                    </datalist>

                            </div>

                            <div id="serviceform" class="my-4" style="display:none;">
                                  <p>Select the service...</p>                 
                                  <select id="service" class="form-control" name="service">
                                          {%for s in services %}
                                            <option id="{{s.client.name}}" value="{{s.id}}"> {{s.service}}</option>
                                          {%endfor%}
                                  </select>
                            </div>


                            <div id="dataform" class="my-5" style="display:none;">
                                <hr>
                                <div class="mt-4">

                                <h4>Information</h4>                 
                              </div>

                                <div class="d-flex flex-row-reverse my-4">
                                  {{adjform.notice_date}} <span>Notice date<span>
                                </div>

                                <div class="d-flex flex-row-reverse my-4">
                                  {{adjform.adj_percent}}<span>Adust %<span>
                                </div>
                                <br>
                                <hr>
                                <div class="d-flex flex-row-reverse my-4">
                                  {{adjform.date_alert}}  <span>Email reminder<span>
                                </div>
                                

                                <div class="d-flex flex-row-reverse">

                                <button type="submit" class="btn btn-primary mt-5 mb-3 px-5 fs-3" name="adj"> Ok </button>
                              </div>

                            </div>

                        </form>

                            
                    </div>

                </div> 


            </div>
            
        </div>


        


  


{% endblock %}

{% block additional_js %}

<script>             
  
  var type = document.getElementById("type");

  // Create the first option
  var option = document.createElement("option");
  option.text = "Account/Service";
  option.value = "";
  option.disabled = true;
  option.selected = true;
  
  // Add the first option to the dropdown list
  type.add(option, 0);
  

    var client = document.getElementById("client");
    var service = document.getElementById("service");

    var clientdiv = document.getElementById("clientform");
    var servicediv = document.getElementById("serviceform");
    var datadiv = document.getElementById("dataform");

    clientdiv.style.display = (type.value !== "---------") ? "none" : "block";
    servicediv.style.display = (type.value !== "---------") ? "none" : "block";

    type.onchange=function(){
    
        if(this.value=="Account"){
            clientdiv.style.display="block";
            servicediv.style.display="none";
            datadiv.style.display="none"; 

        }else if(this.value=="Service"){
            clientdiv.style.display="block";
            datadiv.style.display="none"; 

        }else{
            clientdiv.style.display="none";
            servicediv.style.display="none";
            datadiv.style.display="none"; 

        }
    }     
    
    client.onchange=function(){
      if(type.value=="Service"){
      servicediv.style.display="block"; 
    }else{
      servicediv.style.display="none";
      datadiv.style.display="block"; 
    }
    }


    service.onchange=function(){
     
      datadiv.style.display="block"; 
    }


    
    
       
</script>

<script>
    $(document).ready(function() {
      var $clientField = $('#client');
      var $clientForm = $('#clientform');
      var $clientInput = $clientField.find('input');
  
      $clientInput.autocomplete({
        source: '/client-autocomplete/',
        minLength: 2,
        select: function(event, ui) {
          $clientInput.val(ui.item.value);
          return false;
        },
        focus: function(event, ui) {
          $clientInput.val(ui.item.value);
          return false;
        }
      });
  
      $clientInput.on('input', function() {
        if ($clientInput.val() === '') {
          $clientForm.hide();
        } else {
          $clientForm.show();
        }
      });
    });
  </script>

  <script>// Get the client and service select fields
    var $clientInput = $('#client');
    var $serviceSelect = $('#service');
    
    // Add an event listener to the client input field to trigger the filterServices function
    $clientInput.on('change', filterServices);
    
    function filterServices() {
      // Get the name of the selected client
      var clientName = $clientInput.val();
    
      // Loop through each option in the service select field and show/hide based on the selected client
      $serviceSelect.find('option').each(function() {
        var optionClientName = $(this).attr('id');
        if (optionClientName === clientName) {
          $(this).show();
        } else {
          $(this).hide();
        }
      });
    
      // Reset the service select field to show the first available option
      $serviceSelect.val($serviceSelect.find('option:visible:first').val());
    }
    
    
 </script>
  

{% endblock %}
